在创建防火墙规则时，通常没必要创建相反方向的防火墙规则，防火墙将自动计算出这个规则。

## iptables中的表
iptables根据功能划分不同的表来处理不同的功能逻辑，当前包含5个表，分别为filter、nat、mangle、raw和security。

### filter过滤表

filter是iptables的默认表，主要用于报文过滤，在这里根据报文的内容对报文进行丢弃或者接受。它包含有3个内置规则链。
- INPUT输入链，处理目标地址为本机IP地址的报文。
- OUTPUT输出链，处理本机IP地址产生的报文。
- FORWARD转发链，处理经过本机路由的报文。
这样每个IP的报文只经过这3个内置链中的一个，便于进行数据报文匹配和处理。这里是真正实现防火墙处理的地方。注意：
- 经过本机转发的报文只经过FORWARD链。
- 本机产生的报文只经过OUTPUT链。
- 去往主机的报文只经过该主机的INPUT链。

### nat网络地址转换表

nat用来完成源/目的地址和端口的转换，当一个报文在创建一个新的连接时进入该表。它也有3个内置规则链。
- PREROUTING：用于修改到来的报文，只用来做网络地址转换。
- OUTPUT：用于修改本机产生的并且在路由处理之前的报文。
- POSTROUTING：用于修改准备出去的报文的地方。
网络地址转换在路由功能前后都可能发生，源地址抓换是在数据包通过路由之后在POSTROUTING规则链进行地址转换。目的地址转换是在路由之前，在PREROUTING规则链进行地址转换。

### mangle修改表

这个表主要用来进行报文修改，有5个内置规则链。
- PREROUTING：针对到来的报文，在路由之前修改的地方。
- INPUT：针对目的地址为网管本身的报文。
- FORWARD：针对通过网管路由转发的报文。
- POSTROUTING：将要发送出去的报文的地方。
- OUTPUT：本机产生报文在路由之前修改的地方。
通常使用该表进行报文修改，以便进行Qos和策略路由。通常每一个报文都进入该表，但不使用它来做报文过滤。

### raw原始表

这个表很少被用到，主要用于配置跟连接踪相关内容，在ip_conntrack之前调用。它提供了两个内置规则。
- PREROUTING：到达本机的报文。
- OUTPUT：本机进程产生的报文。
此外还有security表，这个表用于安全linux的防火墙规则，是iptables最近新增表，在实际项目中还很少用到。

## 处理目标

防火墙规则检测报文的特征是否符合规则，如果匹配，就进入规则的处理目标（TARGET）中。如果报文不匹配则进入该规则链的下一条规则进行检测。就这样逐条规则进行比较，知道整个规则链比较完成。规则的处理目标可以是用户定义的自定义链名，也可以是系统内置的4种处理方式。
- ACCEPT：接收，表示让这个报文通过。
- DROP：丢弃，表示将这个报文丢弃。
- QUEUE：入队，表示将这个报文传递到用户空间的队列中。
- RETURN：返回，表示停止这条规则链的匹配，返回到调用这个规则链的上一条规则链的规则处执行。如果达到了一个内建的规则链的末端，或者遇到内置链的规则目标是TARGET，报文的命运将由规则链指定的默认目标处理方式决定。
还有其他拓展的目标处理方式，例如REJECT、DNAT、SNAT、MASQUERADE、LOG和REDIRECT等。


-----

iptables -t nat -L -n -v

iptables -t nat -A PREROUTING -i p32p1 -d 192.168.2.50 -p tcp --dport 25901 -j DNAT --to-destination 192.168.1.37:5901

iptables -t nat -A PREROUTING -i p32p1 -d 192.168.2.50 -p tcp --dport 20022 -j DNAT --to-destination 192.168.1.37:22