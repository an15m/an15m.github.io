<h3 id="列出和删除iptables"><a href="#列出和删除iptables" class="headerlink" title="列出和删除iptables"></a>列出和删除iptables</h3><h4 id="按规范列出iptables-按创建时的语句列出"><a href="#按规范列出iptables-按创建时的语句列出" class="headerlink" title="按规范列出iptables(按创建时的语句列出)"></a>按规范列出iptables(按创建时的语句列出)</h4><p>列出所有激活的iptables rules</p>
<pre><code class="bash">$ sudo iptables -S
</code></pre>
<h4 id="列出特定的Chain"><a href="#列出特定的Chain" class="headerlink" title="列出特定的Chain"></a>列出特定的Chain</h4><pre><code class="bash">$ sudo iptables -S TCP
$ sudo iptables -S INPUT
...
</code></pre>
<h4 id="以tables的形式列出"><a href="#以tables的形式列出" class="headerlink" title="以tables的形式列出"></a>以tables的形式列出</h4><pre><code class="bash">$ sudo iptables -L
</code></pre>
<h4 id="按规范删除iptables"><a href="#按规范删除iptables" class="headerlink" title="按规范删除iptables"></a>按规范删除iptables</h4><p>在添加该iptables的命令中iptables后面表示添加的参数(例如<code>-I -A</code>)换成<code>-D</code>就行了</p>
<pre><code class="bash">$ sudo iptables -A INPUT -m conntrack --ctstate INVALID -j DROP <span class="comment">#添加</span>
$ sudo iptables -D INPUT -m conntrack --ctstate INVALID -j DROP <span class="comment">#对应的删除</span>
</code></pre>
<h4 id="按chain和number来删除规则"><a href="#按chain和number来删除规则" class="headerlink" title="按chain和number来删除规则"></a>按chain和number来删除规则</h4><p>首先通过下面命令来列出规则：</p>
<pre><code class="bash">$ sudo iptables -L --line-number
</code></pre>
<pre><code># 示例输出
Chain INPUT (policy DROP)
num  target     prot opt source               destination
1    ACCEPT     all  --  anywhere             anywhere             ctstate RELATED,ESTABLISHED
2    ACCEPT     all  --  anywhere             anywhere
3    DROP       all  --  anywhere             anywhere             ctstate INVALID
...
</code></pre><p>然后我们就可以通过chain name和num来删除一条规则：</p>
<pre><code class="bash"><span class="comment"># 删除第三列target为DROP的那个规则</span>
$ sudo iptables -D INPUT 3  <span class="comment"># INPUT 为第一行 Chain后面的名字，num为下面要删除的那个规则那一行首的num</span>
</code></pre>
<h4 id="NOTES"><a href="#NOTES" class="headerlink" title="NOTES"></a>NOTES</h4><p>我在第一次尝试的时候首先通过以下命令添加了规则：</p>
<pre><code class="bash">sudo iptables -t nat -I PREROUTING -p tcp --dport 443 -j REDIRECT --to-ports 8443
sudo iptables -t nat -I OUTPUT -p tcp -o lo --dport 443 -j REDIRECT --to-ports 8443
</code></pre>
<p>然后就用列出规则的命令查看，结果怎么都出不来。<br>原因如下：<br>通过<code>-t nat</code>添加的规则，是添加到了一个叫nat的table中。而不用-t参数的时候，系统有个默认的叫做filter的table，所有不加-t参数的命令都是在操作filter这个table。<br>那么到底怎么才能操作nat这个table呢？很简单，只要在上面所有命令中iptables的后面也加上一个<code>-t nat</code>就可以了。比如要列出规则：</p>
<pre><code class="bash">$ sudo iptables -t nat -L
</code></pre>
